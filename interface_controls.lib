#!/bin/bash

read_mode() {

    mode=$(iw dev ${ifname} info | grep "type" | awk '{print $2}')

}

read_channel() {

    channel_adapter=$(iw dev ${ifname} info | grep "channel" | awk '{print $2}')

    if [[ -z "$ifname" ]];
    then
        channel_adapter=
    fi

}

switch_mode() {

    if ! [[ -z "$ifname" ]];
    then
        case $mode in
            "managed")
                # mode="monitor"
                sudo ip link set ${ifname} down
                sudo iw ${ifname} set type monitor
                sudo ip link set ${ifname} up
                read_mode
                ;;
            "monitor")
                # mode="managed"
                sudo ip link set ${ifname} down
                sudo iw ${ifname} set type managed
                sudo ip link set ${ifname} up
                read_mode
                ;;
            *)
                ;;
        esac
    else
        echo "No Network Interface Selected."
        sleep 1
    fi

}

switch_channel() {

    if ! [[ -z "$ifname" ]] && ! [[ -z "$channel_network" ]];
    then

        sudo iw ${ifname} set channel ${channel_network}
        channel_adapter=${channel_network}
        
    else
        echo "No Network Interface or WiFi Network Channel Found."
        sleep 1
    fi

}

select_ifname() {

    printf '\033c'

    status_bar
    echo "SELECT NETWORK INTERFACE"

    arr_len=${#ifnames[@]}

    # list all available network interfaces
    PS3="> "

    select ifname in ${ifnames[@]}
    do
        case $REPLY in
            [1-${arr_len}])
                read_mode
                read_channel
                main_menu
                ;;
            *)
                echo "Invalid Selection."
                sleep 1
                select_ifname
                ;;
        esac
    done

}